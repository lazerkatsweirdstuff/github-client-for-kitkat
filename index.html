<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Client for KitKat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        input, textarea, button, select {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:disabled {
            background-color: #cccccc;
        }
        button.danger {
            background-color: #d73a49;
        }
        button.secondary {
            background-color: #6c757d;
        }
        .repo-item, .file-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .repo-item:last-child, .file-item:last-child {
            border-bottom: none;
        }
        .repo-name, .file-name {
            font-weight: bold;
            color: #0366d6;
        }
        .repo-desc, .file-content {
            color: #666;
            font-size: 0.9em;
        }
        .error {
            color: #d73a49;
            font-weight: bold;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            color: #666;
        }
        .auth-section, .repo-section {
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 15px;
            background-color: #eee;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tab.active {
            background-color: white;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .file-actions {
            margin-top: 10px;
        }
        .file-content-editor {
            width: 100%;
            min-height: 200px;
            font-family: monospace;
        }
        .breadcrumb {
            margin-bottom: 10px;
        }
        .breadcrumb a {
            color: #0366d6;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1>GitHub Client</h1>
    
    <div class="container" id="authContainer">
        <h2>Authentication</h2>
        <div>
            <p>Note: For security, use a personal access token (PAT) with repo scope.</p>
            <input type="text" id="username" placeholder="GitHub username" />
            <input type="password" id="token" placeholder="Personal Access Token" />
            <button id="loginBtn">Login</button>
            <div id="authStatus"></div>
        </div>
    </div>
    
    <div class="container auth-section" id="userContainer">
        <h2>Welcome, <span id="userName"></span></h2>
        <button id="logoutBtn" class="danger">Logout</button>
    </div>
    
    <div class="container auth-section" id="reposContainer">
        <div class="tabs">
            <div class="tab active" data-tab="repos">My Repositories</div>
            <div class="tab" data-tab="create">Create Repository</div>
            <div class="tab" data-tab="search">Search Users</div>
        </div>
        
        <div class="tab-content active" id="repos-tab">
            <button id="refreshReposBtn">Refresh Repositories</button>
            <div id="reposList"></div>
        </div>
        
        <div class="tab-content" id="create-tab">
            <input type="text" id="newRepoName" placeholder="Repository name" />
            <textarea id="newRepoDesc" placeholder="Description"></textarea>
            <select id="newRepoVisibility">
                <option value="public">Public</option>
                <option value="private">Private</option>
            </select>
            <button id="createRepoBtn">Create Repository</button>
            <div id="createRepoStatus"></div>
        </div>
        
        <div class="tab-content" id="search-tab">
            <input type="text" id="searchUser" placeholder="GitHub username" />
            <button id="searchUserBtn">Search User</button>
            <div id="userSearchResults"></div>
        </div>
    </div>
    
    <div class="container auth-section" id="repoEditContainer" style="display: none;">
        <div class="breadcrumb" id="repoBreadcrumb"></div>
        <h2>Repository: <span id="editRepoName"></span></h2>
        
        <div class="tabs">
            <div class="tab active" data-tab="repo-info">Repository Info</div>
            <div class="tab" data-tab="repo-files">Files</div>
        </div>
        
        <div class="tab-content active" id="repo-info-tab">
            <textarea id="editRepoDesc" placeholder="Description"></textarea>
            <button id="updateRepoBtn">Update Repository</button>
            <button id="deleteRepoBtn" class="danger">Delete Repository</button>
            <button id="backToReposBtn">Back to Repositories</button>
            <div id="repoEditStatus"></div>
        </div>
        
        <div class="tab-content" id="repo-files-tab">
            <div id="fileBrowser"></div>
            <div id="fileEditor" style="display: none;">
                <textarea id="fileContentEditor" class="file-content-editor"></textarea>
                <div class="file-actions">
                    <button id="saveFileBtn">Save File</button>
                    <button id="cancelEditFileBtn" class="secondary">Cancel</button>
                    <button id="deleteFileBtn" class="danger">Delete File</button>
                </div>
                <div id="fileEditStatus"></div>
            </div>
            <div id="fileCreate" style="display: none;">
                <input type="text" id="newFileName" placeholder="File path (e.g., folder/file.txt)" />
                <textarea id="newFileContent" class="file-content-editor" placeholder="File content"></textarea>
                <div class="file-actions">
                    <button id="createFileBtn">Create File</button>
                    <button id="cancelCreateFileBtn" class="secondary">Cancel</button>
                </div>
                <div id="fileCreateStatus"></div>
            </div>
            <div id="fileActions">
                <button id="newFileBtn">New File</button>
                <button id="refreshFilesBtn">Refresh Files</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        var authToken = null;
        var currentUser = null;
        var currentRepo = null;
        var currentPath = '';
        var currentFile = null;
        var currentFileSha = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            var loginBtn = document.getElementById('loginBtn');
            var logoutBtn = document.getElementById('logoutBtn');
            var usernameInput = document.getElementById('username');
            var tokenInput = document.getElementById('token');
            var authStatus = document.getElementById('authStatus');
            var userContainer = document.getElementById('userContainer');
            var reposContainer = document.getElementById('reposContainer');
            var userNameSpan = document.getElementById('userName');
            var reposList = document.getElementById('reposList');
            var refreshReposBtn = document.getElementById('refreshReposBtn');
            var createRepoBtn = document.getElementById('createRepoBtn');
            var newRepoName = document.getElementById('newRepoName');
            var newRepoDesc = document.getElementById('newRepoDesc');
            var newRepoVisibility = document.getElementById('newRepoVisibility');
            var createRepoStatus = document.getElementById('createRepoStatus');
            var searchUserBtn = document.getElementById('searchUserBtn');
            var searchUserInput = document.getElementById('searchUser');
            var userSearchResults = document.getElementById('userSearchResults');
            var repoEditContainer = document.getElementById('repoEditContainer');
            var editRepoName = document.getElementById('editRepoName');
            var editRepoDesc = document.getElementById('editRepoDesc');
            var updateRepoBtn = document.getElementById('updateRepoBtn');
            var deleteRepoBtn = document.getElementById('deleteRepoBtn');
            var backToReposBtn = document.getElementById('backToReposBtn');
            var repoEditStatus = document.getElementById('repoEditStatus');
            var repoBreadcrumb = document.getElementById('repoBreadcrumb');
            var fileBrowser = document.getElementById('fileBrowser');
            var fileEditor = document.getElementById('fileEditor');
            var fileContentEditor = document.getElementById('fileContentEditor');
            var saveFileBtn = document.getElementById('saveFileBtn');
            var cancelEditFileBtn = document.getElementById('cancelEditFileBtn');
            var deleteFileBtn = document.getElementById('deleteFileBtn');
            var fileEditStatus = document.getElementById('fileEditStatus');
            var fileCreate = document.getElementById('fileCreate');
            var newFileName = document.getElementById('newFileName');
            var newFileContent = document.getElementById('newFileContent');
            var createFileBtn = document.getElementById('createFileBtn');
            var cancelCreateFileBtn = document.getElementById('cancelCreateFileBtn');
            var fileCreateStatus = document.getElementById('fileCreateStatus');
            var newFileBtn = document.getElementById('newFileBtn');
            var refreshFilesBtn = document.getElementById('refreshFilesBtn');
            
            // Tab switching
            function setupTabs(container) {
                var tabs = container.querySelectorAll('.tab');
                tabs.forEach(function(tab) {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs and contents in this container
                        container.querySelectorAll('.tab').forEach(function(t) {
                            t.classList.remove('active');
                        });
                        container.querySelectorAll('.tab-content').forEach(function(c) {
                            c.classList.remove('active');
                        });
                        
                        // Add active class to clicked tab and corresponding content
                        this.classList.add('active');
                        container.querySelector('#' + this.getAttribute('data-tab') + '-tab').classList.add('active');
                    });
                });
            }
            
            setupTabs(reposContainer);
            setupTabs(repoEditContainer);
            
            // Event listeners
            loginBtn.addEventListener('click', login);
            logoutBtn.addEventListener('click', logout);
            refreshReposBtn.addEventListener('click', loadRepositories);
            createRepoBtn.addEventListener('click', createRepository);
            searchUserBtn.addEventListener('click', searchGitHubUser);
            updateRepoBtn.addEventListener('click', updateRepository);
            deleteRepoBtn.addEventListener('click', deleteRepository);
            backToReposBtn.addEventListener('click', function() {
                repoEditContainer.style.display = 'none';
                reposContainer.style.display = 'block';
                currentRepo = null;
                currentPath = '';
            });
            
            newFileBtn.addEventListener('click', function() {
                fileBrowser.style.display = 'none';
                fileEditor.style.display = 'none';
                fileCreate.style.display = 'block';
                newFileName.value = '';
                newFileContent.value = '';
                fileCreateStatus.innerHTML = '';
            });
            
            refreshFilesBtn.addEventListener('click', function() {
                browseFiles(currentPath);
            });
            
            saveFileBtn.addEventListener('click', saveFile);
            cancelEditFileBtn.addEventListener('click', cancelEditFile);
            deleteFileBtn.addEventListener('click', deleteFile);
            createFileBtn.addEventListener('click', createFile);
            cancelCreateFileBtn.addEventListener('click', cancelCreateFile);
            
            // Check if already logged in (from sessionStorage)
            if (sessionStorage.getItem('githubToken')) {
                authToken = sessionStorage.getItem('githubToken');
                currentUser = sessionStorage.getItem('githubUser');
                showAuthenticatedUI();
                loadUserDetails();
                loadRepositories();
            }
            
            function login() {
                var username = usernameInput.value.trim();
                var token = tokenInput.value.trim();
                
                if (!username || !token) {
                    authStatus.innerHTML = '<div class="error">Please enter both username and token</div>';
                    return;
                }
                
                authToken = token;
                currentUser = username;
                
                // Verify credentials by fetching user details
                githubRequest('GET', 'https://api.github.com/user', null, function(response) {
                    // Success - save to session storage
                    sessionStorage.setItem('githubToken', authToken);
                    sessionStorage.setItem('githubUser', currentUser);
                    
                    showAuthenticatedUI();
                    loadUserDetails();
                    loadRepositories();
                    
                    authStatus.innerHTML = '<div class="success">Login successful!</div>';
                }, function(error) {
                    authToken = null;
                    currentUser = null;
                    authStatus.innerHTML = '<div class="error">Login failed: ' + (error.message || 'Invalid credentials') + '</div>';
                });
            }
            
            function logout() {
                authToken = null;
                currentUser = null;
                sessionStorage.removeItem('githubToken');
                sessionStorage.removeItem('githubUser');
                
                document.querySelectorAll('.auth-section').forEach(function(el) {
                    el.style.display = 'none';
                });
                document.getElementById('authContainer').style.display = 'block';
                usernameInput.value = '';
                tokenInput.value = '';
                authStatus.innerHTML = '<div class="success">Logged out successfully</div>';
            }
            
            function showAuthenticatedUI() {
                document.getElementById('authContainer').style.display = 'none';
                document.querySelectorAll('.auth-section').forEach(function(el) {
                    el.style.display = 'block';
                });
                userNameSpan.textContent = currentUser;
            }
            
            function loadUserDetails() {
                githubRequest('GET', 'https://api.github.com/user', null, function(user) {
                    userNameSpan.textContent = user.login || currentUser;
                }, function(error) {
                    console.error('Failed to load user details:', error);
                });
            }
            
            function loadRepositories() {
                reposList.innerHTML = '<div class="loading">Loading repositories...</div>';
                
                githubRequest('GET', 'https://api.github.com/user/repos?sort=updated', null, function(repos) {
                    if (repos.length === 0) {
                        reposList.innerHTML = '<div>No repositories found.</div>';
                        return;
                    }
                    
                    var html = '';
                    repos.forEach(function(repo) {
                        html += '<div class="repo-item">' +
                                '<div class="repo-name"><a href="' + repo.html_url + '" target="_blank">' + repo.name + '</a></div>' +
                                '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + ' | ' + 
                                (repo.private ? 'Private' : 'Public') + '</div>' +
                                '<button onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\')">Manage</button>' +
                                '</div>';
                    });
                    
                    reposList.innerHTML = html;
                }, function(error) {
                    reposList.innerHTML = '<div class="error">Failed to load repositories: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function createRepository() {
                var name = newRepoName.value.trim();
                var description = newRepoDesc.value.trim();
                var isPrivate = newRepoVisibility.value === 'private';
                
                if (!name) {
                    createRepoStatus.innerHTML = '<div class="error">Repository name is required</div>';
                    return;
                }
                
                var data = {
                    name: name,
                    description: description,
                    private: isPrivate,
                    auto_init: true
                };
                
                createRepoStatus.innerHTML = '<div class="loading">Creating repository...</div>';
                
                githubRequest('POST', 'https://api.github.com/user/repos', data, function(repo) {
                    createRepoStatus.innerHTML = '<div class="success">Repository created successfully! <a href="' + repo.html_url + '" target="_blank">View on GitHub</a></div>';
                    newRepoName.value = '';
                    newRepoDesc.value = '';
                    loadRepositories();
                }, function(error) {
                    createRepoStatus.innerHTML = '<div class="error">Failed to create repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function searchGitHubUser() {
                var username = searchUserInput.value.trim();
                
                if (!username) {
                    userSearchResults.innerHTML = '<div class="error">Please enter a username</div>';
                    return;
                }
                
                userSearchResults.innerHTML = '<div class="loading">Searching for user...</div>';
                
                githubRequest('GET', 'https://api.github.com/users/' + encodeURIComponent(username), null, function(user) {
                    var html = '<h3>' + user.login + '</h3>' +
                               '<img src="' + user.avatar_url + '" width="100" style="border-radius:50%;"><br>' +
                               '<p>' + (user.name || '') + '</p>' +
                               '<p>' + (user.bio || '') + '</p>' +
                               '<p>Followers: ' + user.followers + ' | Following: ' + user.following + '</p>' +
                               '<button onclick="loadUserRepos(\'' + user.login + '\')">View Repositories</button>';
                    
                    userSearchResults.innerHTML = html;
                }, function(error) {
                    userSearchResults.innerHTML = '<div class="error">User not found: ' + username + '</div>';
                });
            }
            
            function editRepository(owner, repoName) {
                currentRepo = { owner: owner, name: repoName };
                currentPath = '';
                
                githubRequest('GET', 'https://api.github.com/repos/' + owner + '/' + repoName, null, function(repo) {
                    editRepoName.textContent = repoName;
                    editRepoDesc.value = repo.description || '';
                    
                    // Set up breadcrumb
                    updateBreadcrumb();
                    
                    // Load root directory
                    browseFiles('');
                    
                    reposContainer.style.display = 'none';
                    repoEditContainer.style.display = 'block';
                    repoEditStatus.innerHTML = '';
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to load repository details</div>';
                });
            }
            
            function updateRepository() {
                if (!currentRepo) return;
                
                var newDescription = editRepoDesc.value.trim();
                
                var data = {
                    name: currentRepo.name,  // Include name to fix validation error
                    description: newDescription,
                    private: false  // Include private flag if needed
                };
                
                repoEditStatus.innerHTML = '<div class="loading">Updating repository...</div>';
                
                githubRequest('PATCH', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name, data, function(repo) {
                    repoEditStatus.innerHTML = '<div class="success">Repository updated successfully!</div>';
                    loadRepositories();
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to update repository: ' + (error.message || 'Unknown error') + 
                                              (error.errors ? ' - ' + JSON.stringify(error.errors) : '') + '</div>';
                });
            }
            
            function deleteRepository() {
                if (!currentRepo) return;
                
                if (!confirm('Are you sure you want to delete this repository? This action cannot be undone.')) {
                    return;
                }
                
                repoEditStatus.innerHTML = '<div class="loading">Deleting repository...</div>';
                
                githubRequest('DELETE', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name, null, function() {
                    repoEditStatus.innerHTML = '<div class="success">Repository deleted successfully!</div>';
                    setTimeout(function() {
                        repoEditContainer.style.display = 'none';
                        reposContainer.style.display = 'block';
                        currentRepo = null;
                        currentPath = '';
                        loadRepositories();
                    }, 1500);
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to delete repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function browseFiles(path) {
                fileBrowser.innerHTML = '<div class="loading">Loading files...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, null, function(contents) {
                    if (!Array.isArray(contents)) {
                        contents = [contents];
                    }
                    
                    var html = '';
                    
                    // Add parent directory link if not at root
                    if (path) {
                        var parentPath = path.split('/').slice(0, -1).join('/');
                        html += '<div class="file-item">' +
                                '<div class="file-name"><a href="javascript:void(0)" onclick="browseFiles(\'' + parentPath + '\')">../</a></div>' +
                                '<div class="file-content">Parent directory</div>' +
                                '</div>';
                    }
                    
                    contents.forEach(function(item) {
                        if (item.type === 'dir') {
                            html += '<div class="file-item">' +
                                    '<div class="file-name"><a href="javascript:void(0)" onclick="browseFiles(\'' + (path ? path + '/' : '') + item.name + '\')">' + item.name + '/</a></div>' +
                                    '<div class="file-content">Directory</div>' +
                                    '</div>';
                        } else {
                            html += '<div class="file-item">' +
                                    '<div class="file-name"><a href="javascript:void(0)" onclick="viewFile(\'' + (path ? path + '/' : '') + item.name + '\', \'' + item.sha + '\')">' + item.name + '</a></div>' +
                                    '<div class="file-content">' + (item.size ? (item.size + ' bytes') : 'File') + '</div>' +
                                    '</div>';
                        }
                    });
                    
                    fileBrowser.innerHTML = html;
                    fileBrowser.style.display = 'block';
                    fileEditor.style.display = 'none';
                    fileCreate.style.display = 'none';
                    
                    // Update current path and breadcrumb
                    currentPath = path;
                    updateBreadcrumb();
                }, function(error) {
                    fileBrowser.innerHTML = '<div class="error">Failed to load files: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function viewFile(path, sha) {
                currentFile = path;
                currentFileSha = sha;
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, null, function(file) {
                    // Decode base64 content
                    var content = atob(file.content.replace(/\s/g, ''));
                    
                    fileContentEditor.value = content;
                    fileBrowser.style.display = 'none';
                    fileEditor.style.display = 'block';
                    fileCreate.style.display = 'none';
                    fileEditStatus.innerHTML = '';
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to load file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function saveFile() {
                if (!currentFile || !currentFileSha) return;
                
                var newContent = fileContentEditor.value;
                var encodedContent = btoa(newContent);
                
                var data = {
                    message: 'Update ' + currentFile,
                    content: encodedContent,
                    sha: currentFileSha
                };
                
                fileEditStatus.innerHTML = '<div class="loading">Saving file...</div>';
                
                githubRequest('PUT', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, data, function() {
                    fileEditStatus.innerHTML = '<div class="success">File saved successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to save file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function cancelEditFile() {
                browseFiles(currentPath);
            }
            
            function deleteFile() {
                if (!currentFile || !currentFileSha) return;
                
                if (!confirm('Are you sure you want to delete this file?')) {
                    return;
                }
                
                var data = {
                    message: 'Delete ' + currentFile,
                    sha: currentFileSha
                };
                
                fileEditStatus.innerHTML = '<div class="loading">Deleting file...</div>';
                
                githubRequest('DELETE', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, data, function() {
                    fileEditStatus.innerHTML = '<div class="success">File deleted successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to delete file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function createFile() {
                var path = newFileName.value.trim();
                var content = newFileContent.value;
                
                if (!path) {
                    fileCreateStatus.innerHTML = '<div class="error">File path is required</div>';
                    return;
                }
                
                var encodedContent = btoa(content);
                
                var data = {
                    message: 'Create ' + path,
                    content: encodedContent
                };
                
                fileCreateStatus.innerHTML = '<div class="loading">Creating file...</div>';
                
                githubRequest('PUT', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, data, function() {
                    fileCreateStatus.innerHTML = '<div class="success">File created successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileCreateStatus.innerHTML = '<div class="error">Failed to create file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function cancelCreateFile() {
                browseFiles(currentPath);
            }
            
            function updateBreadcrumb() {
                var parts = currentPath.split('/');
                var breadcrumb = '<a href="javascript:void(0)" onclick="browseFiles(\'\')">' + currentRepo.name + '</a>';
                
                var currentPathPart = '';
                parts.forEach(function(part, index) {
                    if (part) {
                        currentPathPart += (currentPathPart ? '/' : '') + part;
                        breadcrumb += ' / <a href="javascript:void(0)" onclick="browseFiles(\'' + currentPathPart + '\')">' + part + '</a>';
                    }
                });
                
                repoBreadcrumb.innerHTML = breadcrumb;
            }
            
            // Make GitHub API requests
            function githubRequest(method, url, data, successCallback, errorCallback) {
                var xhr = new XMLHttpRequest();
                xhr.open(method, url);
                xhr.setRequestHeader('Accept', 'application/vnd.github.v3+json');
                
                if (authToken) {
                    xhr.setRequestHeader('Authorization', 'token ' + authToken);
                }
                
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var response = xhr.responseText ? JSON.parse(xhr.responseText) : null;
                        if (successCallback) successCallback(response);
                    } else {
                        var error = xhr.responseText ? JSON.parse(xhr.responseText) : { message: 'HTTP error ' + xhr.status };
                        if (errorCallback) errorCallback(error);
                    }
                };
                
                xhr.onerror = function() {
                    if (errorCallback) errorCallback({ message: 'Network error' });
                };
                
                if (data) {
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.send(JSON.stringify(data));
                } else {
                    xhr.send();
                }
            }
            
            // Make functions available globally for button onclick handlers
            window.editRepository = editRepository;
            window.browseFiles = browseFiles;
            window.viewFile = viewFile;
            window.loadUserRepos = function(username) {
                userSearchResults.innerHTML = '<div class="loading">Loading repositories...</div>';
                
                githubRequest('GET', 'https://api.github.com/users/' + encodeURIComponent(username) + '/repos', null, function(repos) {
                    if (repos.length === 0) {
                        userSearchResults.innerHTML += '<div>No repositories found for this user.</div>';
                        return;
                    }
                    
                    var html = '<h3>' + username + '\'s Repositories</h3>';
                    repos.forEach(function(repo) {
                        html += '<div class="repo-item">' +
                                '<div class="repo-name"><a href="' + repo.html_url + '" target="_blank">' + repo.name + '</a></div>' +
                                '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + '</div>' +
                                '</div>';
                    });
                    
                    userSearchResults.innerHTML = html;
                }, function(error) {
                    userSearchResults.innerHTML += '<div class="error">Failed to load repositories: ' + (error.message || 'Unknown error') + '</div>';
                });
            };
        });
    </script>
</body>
</html>
