<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KitKat GitHub Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        input, textarea, button, select {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        button:disabled {
            background-color: #cccccc;
        }
        button.danger {
            background-color: #d73a49;
        }
        button.secondary {
            background-color: #6c757d;
        }
        button.info {
            background-color: #0366d6;
        }
        button.download {
            background-color: #6f42c1;
        }
        button.star {
            background-color: transparent;
            color: #ffac33;
            border: none;
            padding: 0;
            margin: 0;
            width: auto;
            font-size: 1.5em;
        }
        .repo-item, .file-item, .collab-item, .release-item, .issue-item, .deployment-item, .user-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .repo-item:last-child, .file-item:last-child, .collab-item:last-child, 
        .release-item:last-child, .issue-item:last-child, .deployment-item:last-child,
        .user-item:last-child {
            border-bottom: none;
        }
        .repo-name, .file-name, .collab-name, .release-name, .issue-name {
            font-weight: bold;
            color: #0366d6;
        }
        .repo-desc, .file-content, .collab-role, .release-desc, .issue-desc {
            color: #666;
            font-size: 0.9em;
        }
        .error {
            color: #d73a49;
            font-weight: bold;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            color: #666;
        }
        .auth-section, .repo-section {
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 15px;
            background-color: #eee;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tab.active {
            background-color: white;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .file-actions, .repo-actions {
            margin-top: 10px;
        }
        .file-content-editor {
            width: 100%;
            min-height: 200px;
            font-family: monospace;
        }
        .breadcrumb {
            margin-bottom: 10px;
        }
        .breadcrumb a {
            color: #0366d6;
            text-decoration: none;
        }
        .markdown-preview {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 3px;
            background-color: white;
        }
        .markdown-preview img {
            max-width: 100%;
        }
        .markdown-preview em {
            font-style: italic;
        }
        .image-preview {
            max-width: 100%;
            margin: 10px 0;
        }
        .collab-avatar, .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }
        .release-asset {
            font-size: 0.8em;
            margin-left: 20px;
            color: #586069;
        }
        .file-download-link {
            display: inline-block;
            margin-top: 5px;
            color: #0366d6;
            text-decoration: none;
        }
        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .user-info {
            margin-left: 15px;
        }
        .user-name {
            font-size: 1.2em;
            font-weight: bold;
        }
        .user-login {
            color: #586069;
        }
        .user-bio {
            margin: 10px 0;
        }
        .user-stats {
            display: flex;
            margin-bottom: 10px;
        }
        .user-stat {
            margin-right: 15px;
        }
        .org-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }
        .issue-label {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 5px;
            color: white;
        }
        .deployment-status {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        .status-success {
            background-color: #28a745;
            color: white;
        }
        .status-pending {
            background-color: #ffd33d;
            color: black;
        }
        .status-failure {
            background-color: #d73a49;
            color: white;
        }
        .gh-pages-actions {
            background-color: #f6f8fa;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .repo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .repo-owner {
            color: #586069;
            font-size: 0.9em;
            margin-left: 5px;
        }
        .file-viewer {
            max-width: 100%;
            overflow-x: auto;
        }
        .readme-content {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .refresh-button {
            background-color: #0366d6;
        }
    </style>
</head>
<body>
    <h1>KitKat GitHub Client</h1>
    
    <div class="container" id="authContainer">
        <h2>Authentication</h2>
        <div>
            <p>Note: For security, use a personal access token (PAT) with repo scope.</p>
            <input type="text" id="username" placeholder="GitHub username" />
            <input type="password" id="token" placeholder="Personal Access Token" />
            <button id="loginBtn">Login</button>
            <div id="authStatus"></div>
        </div>
    </div>
    
    <div class="container auth-section" id="userContainer">
        <h2>Welcome, <span id="userName"></span></h2>
        <button id="logoutBtn" class="danger">Logout</button>
    </div>
    
    <div class="container auth-section" id="reposContainer">
        <div class="tabs">
            <div class="tab active" data-tab="repos">My Repositories</div>
            <div class="tab" data-tab="create">Create Repository</div>
            <div class="tab" data-tab="search">Search Users/Repos</div>
            <div class="tab" data-tab="starred">Starred Repos</div>
            <div class="tab" data-tab="following">Following</div>
        </div>
        
        <div class="tab-content active" id="repos-tab">
            <button id="refreshReposBtn" class="refresh-button">Refresh Repositories</button>
            <div id="reposList"></div>
        </div>
        
        <div class="tab-content" id="create-tab">
            <input type="text" id="newRepoName" placeholder="Repository name" />
            <textarea id="newRepoDesc" placeholder="Description"></textarea>
            <select id="newRepoVisibility">
                <option value="public">Public</option>
                <option value="private">Private</option>
            </select>
            <div>
                <input type="checkbox" id="addReadme" checked>
                <label for="addReadme">Initialize with README</label>
            </div>
            <div>
                <input type="checkbox" id="addGitignore">
                <label for="addGitignore">Add .gitignore</label>
                <select id="gitignoreTemplate" disabled>
                    <option value="">Select template</option>
                    <option value="Android">Android</option>
                    <option value="Node">Node</option>
                    <option value="Python">Python</option>
                    <option value="Java">Java</option>
                </select>
            </div>
            <div>
                <input type="checkbox" id="addLicense">
                <label for="addLicense">Add license</label>
                <select id="licenseTemplate" disabled>
                    <option value="">Select license</option>
                    <option value="mit">MIT</option>
                    <option value="apache-2.0">Apache 2.0</option>
                    <option value="gpl-3.0">GPL-3.0</option>
                </select>
            </div>
            <button id="createRepoBtn">Create Repository</button>
            <div id="createRepoStatus"></div>
        </div>
        
        <div class="tab-content" id="search-tab">
            <input type="text" id="searchQuery" placeholder="Username or repo (user/repo)" />
            <button id="searchUserBtn">Search Users</button>
            <button id="searchRepoBtn">Search Repos</button>
            <div id="searchResults"></div>
        </div>
        
        <div class="tab-content" id="starred-tab">
            <button id="refreshStarredBtn" class="refresh-button">Refresh Starred</button>
            <div id="starredRepos"></div>
        </div>
        
        <div class="tab-content" id="following-tab">
            <button id="refreshFollowingBtn" class="refresh-button">Refresh Following</button>
            <div id="followingList"></div>
        </div>
    </div>
    
    <div class="container auth-section" id="repoEditContainer" style="display: none;">
        <div class="breadcrumb" id="repoBreadcrumb"></div>
        <div class="repo-header">
            <h2>Repository: <span id="editRepoName"></span> <span class="repo-owner" id="repoOwner"></span></h2>
            <div>
                <button id="starRepoBtn" class="star" style="display: none;">☆</button>
                <button id="unstarRepoBtn" class="star" style="display: none;">★</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="repo-info">Repository Info</div>
            <div class="tab" data-tab="repo-files">Files</div>
            <div class="tab" data-tab="repo-collabs">Collaborators</div>
            <div class="tab" data-tab="repo-releases">Releases</div>
            <div class="tab" data-tab="repo-issues">Issues</div>
            <div class="tab" data-tab="repo-deployments">Deployments</div>
            <div class="tab" data-tab="repo-pages">GitHub Pages</div>
        </div>
        
        <div class="tab-content active" id="repo-info-tab">
            <textarea id="editRepoDesc" placeholder="Description"></textarea>
            <div id="repoReadme" class="readme-content"></div>
            <div class="repo-actions">
                <button id="updateRepoBtn">Update Repository</button>
                <button id="deleteRepoBtn" class="danger">Delete Repository</button>
                <button id="backToReposBtn">Back to Repositories</button>
            </div>
            <div id="repoEditStatus"></div>
        </div>
        
        <div class="tab-content" id="repo-files-tab">
            <div id="fileBrowser"></div>
            <div id="fileEditor" style="display: none;">
                <div class="file-viewer">
                    <textarea id="fileContentEditor" class="file-content-editor"></textarea>
                    <div id="markdownPreview" class="markdown-preview" style="display: none;"></div>
                    <div id="imagePreview" style="display: none;">
                        <img id="imagePreviewImg" class="image-preview" />
                        <a id="downloadImageBtn" href="#" class="file-download-link" download>Download Image</a>
                    </div>
                    <div id="fileDownload" style="display: none;">
                        <a id="downloadFileBtn" href="#" class="file-download-link" download>Download File</a>
                    </div>
                </div>
                <div class="file-actions">
                    <button id="saveFileBtn">Save File</button>
                    <button id="renameFileBtn" class="info">Rename File</button>
                    <button id="backToFilesBtn" class="secondary">Back to Files</button>
                    <button id="cancelEditFileBtn" class="secondary">Cancel</button>
                    <button id="deleteFileBtn" class="danger">Delete File</button>
                    <button id="downloadBtn" class="download">Download</button>
                    <button id="openInNewTabBtn" class="info">Open in New Tab</button>
                </div>
                <div id="fileEditStatus"></div>
            </div>
            <div id="fileCreate" style="display: none;">
                <input type="text" id="newFileName" placeholder="File path (e.g., folder/file.txt)" />
                <textarea id="newFileContent" class="file-content-editor" placeholder="File content"></textarea>
                <div class="file-actions">
                    <button id="createFileBtn">Create File</button>
                    <button id="cancelCreateFileBtn" class="secondary">Cancel</button>
                </div>
                <div id="fileCreateStatus"></div>
            </div>
            <div id="fileRename" style="display: none;">
                <input type="text" id="renameFilePath" placeholder="New file path" />
                <div class="file-actions">
                    <button id="confirmRenameFileBtn">Rename File</button>
                    <button id="cancelRenameFileBtn" class="secondary">Cancel</button>
                </div>
                <div id="fileRenameStatus"></div>
            </div>
            <div class="file-actions">
                <button id="newFileBtn">New File</button>
                <button id="refreshFilesBtn" class="refresh-button">Refresh Files</button>
                <button id="backToReposFromFilesBtn">Back to Repositories</button>
            </div>
        </div>
        
        <div class="tab-content" id="repo-collabs-tab">
            <div id="collabsList"></div>
            <div class="file-actions">
                <button id="refreshCollabsBtn" class="refresh-button">Refresh Collaborators</button>
                <button id="backToReposFromCollabsBtn">Back to Repositories</button>
            </div>
        </div>
        
        <div class="tab-content" id="repo-releases-tab">
            <div class="file-actions">
                <button id="newReleaseBtn">Create Release</button>
                <button id="refreshReleasesBtn" class="refresh-button">Refresh Releases</button>
                <button id="backToReposFromReleasesBtn">Back to Repositories</button>
            </div>
            <div id="releasesList"></div>
        </div>
        
        <div class="tab-content" id="repo-issues-tab">
            <div id="issuesList"></div>
            <div class="file-actions">
                <button id="refreshIssuesBtn" class="refresh-button">Refresh Issues</button>
                <button id="backToReposFromIssuesBtn">Back to Repositories</button>
            </div>
        </div>
        
        <div class="tab-content" id="repo-deployments-tab">
            <div id="deploymentsList"></div>
            <div class="file-actions">
                <button id="refreshDeploymentsBtn" class="refresh-button">Refresh Deployments</button>
                <button id="backToReposFromDeploymentsBtn">Back to Repositories</button>
            </div>
        </div>
        
        <div class="tab-content" id="repo-pages-tab">
            <div id="ghPagesInfo"></div>
            <div class="gh-pages-actions">
                <p>GitHub Pages defaults to serving static HTML files from these locations:</p>
                <ul>
                    <li><code>docs/</code> folder on the main branch</li>
                    <li><code>gh-pages</code> branch root</li>
                    <li><code>master</code> branch root (legacy)</li>
                </ul>
                <p>Basic structure for a static site:</p>
                <pre>index.html
css/styles.css
js/script.js
images/</pre>
                <p>Or create this GitHub Actions workflow for more control:</p>
                <pre>name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: echo "Your build commands here" > build.sh
      - run: chmod +x build.sh
      - run: ./build.sh
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public</pre>
            </div>
            <div class="file-actions">
                <button id="visitPagesBtn" style="display: none;">Visit GitHub Pages Site</button>
                <button id="refreshPagesBtn" class="refresh-button">Refresh Pages Info</button>
                <button id="backToReposFromPagesBtn">Back to Repositories</button>
            </div>
        </div>
    </div>
    
    <div class="container auth-section" id="userProfileContainer" style="display: none;">
        <div id="userProfileContent"></div>
        <div class="file-actions">
            <button id="backFromUserProfileBtn">Back</button>
            <button id="followUserBtn" style="display: none;">Follow User</button>
            <button id="unfollowUserBtn" style="display: none;">Unfollow User</button>
        </div>
    </div>
    
    <div class="container auth-section" id="releaseCreateContainer" style="display: none;">
        <h2>Create New Release</h2>
        <input type="text" id="releaseTagName" placeholder="Tag name (e.g., v1.0.0)" />
        <input type="text" id="releaseName" placeholder="Release name" />
        <textarea id="releaseBody" placeholder="Release description (markdown)"></textarea>
        <div class="file-actions">
            <button id="createReleaseBtn">Create Release</button>
            <button id="cancelCreateReleaseBtn" class="secondary">Cancel</button>
        </div>
        <div id="releaseCreateStatus"></div>
    </div>

    <script>
        // Global variables
        var authToken = null;
        var currentUser = null;
        var currentRepo = null;
        var currentPath = '';
        var currentFile = null;
        var currentFileSha = null;
        var isViewingExternalRepo = false;
        var currentDownloadUrl = null;
        var isRepoStarred = false;
        var currentProfileUser = null;
        var isFollowingUser = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            var loginBtn = document.getElementById('loginBtn');
            var logoutBtn = document.getElementById('logoutBtn');
            var usernameInput = document.getElementById('username');
            var tokenInput = document.getElementById('token');
            var authStatus = document.getElementById('authStatus');
            var userContainer = document.getElementById('userContainer');
            var reposContainer = document.getElementById('reposContainer');
            var userNameSpan = document.getElementById('userName');
            var reposList = document.getElementById('reposList');
            var refreshReposBtn = document.getElementById('refreshReposBtn');
            var createRepoBtn = document.getElementById('createRepoBtn');
            var newRepoName = document.getElementById('newRepoName');
            var newRepoDesc = document.getElementById('newRepoDesc');
            var newRepoVisibility = document.getElementById('newRepoVisibility');
            var addReadme = document.getElementById('addReadme');
            var addGitignore = document.getElementById('addGitignore');
            var gitignoreTemplate = document.getElementById('gitignoreTemplate');
            var addLicense = document.getElementById('addLicense');
            var licenseTemplate = document.getElementById('licenseTemplate');
            var createRepoStatus = document.getElementById('createRepoStatus');
            var searchUserBtn = document.getElementById('searchUserBtn');
            var searchRepoBtn = document.getElementById('searchRepoBtn');
            var searchQuery = document.getElementById('searchQuery');
            var searchResults = document.getElementById('searchResults');
            var starredRepos = document.getElementById('starredRepos');
            var refreshStarredBtn = document.getElementById('refreshStarredBtn');
            var followingList = document.getElementById('followingList');
            var refreshFollowingBtn = document.getElementById('refreshFollowingBtn');
            var repoEditContainer = document.getElementById('repoEditContainer');
            var editRepoName = document.getElementById('editRepoName');
            var repoOwner = document.getElementById('repoOwner');
            var editRepoDesc = document.getElementById('editRepoDesc');
            var repoReadme = document.getElementById('repoReadme');
            var starRepoBtn = document.getElementById('starRepoBtn');
            var unstarRepoBtn = document.getElementById('unstarRepoBtn');
            var updateRepoBtn = document.getElementById('updateRepoBtn');
            var deleteRepoBtn = document.getElementById('deleteRepoBtn');
            var backToReposBtn = document.getElementById('backToReposBtn');
            var repoEditStatus = document.getElementById('repoEditStatus');
            var repoBreadcrumb = document.getElementById('repoBreadcrumb');
            var fileBrowser = document.getElementById('fileBrowser');
            var fileEditor = document.getElementById('fileEditor');
            var fileContentEditor = document.getElementById('fileContentEditor');
            var markdownPreview = document.getElementById('markdownPreview');
            var imagePreview = document.getElementById('imagePreview');
            var imagePreviewImg = document.getElementById('imagePreviewImg');
            var downloadImageBtn = document.getElementById('downloadImageBtn');
            var fileDownload = document.getElementById('fileDownload');
            var downloadFileBtn = document.getElementById('downloadFileBtn');
            var saveFileBtn = document.getElementById('saveFileBtn');
            var renameFileBtn = document.getElementById('renameFileBtn');
            var backToFilesBtn = document.getElementById('backToFilesBtn');
            var cancelEditFileBtn = document.getElementById('cancelEditFileBtn');
            var deleteFileBtn = document.getElementById('deleteFileBtn');
            var downloadBtn = document.getElementById('downloadBtn');
            var openInNewTabBtn = document.getElementById('openInNewTabBtn');
            var fileEditStatus = document.getElementById('fileEditStatus');
            var fileCreate = document.getElementById('fileCreate');
            var newFileName = document.getElementById('newFileName');
            var newFileContent = document.getElementById('newFileContent');
            var createFileBtn = document.getElementById('createFileBtn');
            var cancelCreateFileBtn = document.getElementById('cancelCreateFileBtn');
            var fileCreateStatus = document.getElementById('fileCreateStatus');
            var fileRename = document.getElementById('fileRename');
            var renameFilePath = document.getElementById('renameFilePath');
            var confirmRenameFileBtn = document.getElementById('confirmRenameFileBtn');
            var cancelRenameFileBtn = document.getElementById('cancelRenameFileBtn');
            var fileRenameStatus = document.getElementById('fileRenameStatus');
            var newFileBtn = document.getElementById('newFileBtn');
            var refreshFilesBtn = document.getElementById('refreshFilesBtn');
            var backToReposFromFilesBtn = document.getElementById('backToReposFromFilesBtn');
            var collabsList = document.getElementById('collabsList');
            var refreshCollabsBtn = document.getElementById('refreshCollabsBtn');
            var backToReposFromCollabsBtn = document.getElementById('backToReposFromCollabsBtn');
            var releasesList = document.getElementById('releasesList');
            var newReleaseBtn = document.getElementById('newReleaseBtn');
            var refreshReleasesBtn = document.getElementById('refreshReleasesBtn');
            var backToReposFromReleasesBtn = document.getElementById('backToReposFromReleasesBtn');
            var issuesList = document.getElementById('issuesList');
            var refreshIssuesBtn = document.getElementById('refreshIssuesBtn');
            var backToReposFromIssuesBtn = document.getElementById('backToReposFromIssuesBtn');
            var deploymentsList = document.getElementById('deploymentsList');
            var refreshDeploymentsBtn = document.getElementById('refreshDeploymentsBtn');
            var backToReposFromDeploymentsBtn = document.getElementById('backToReposFromDeploymentsBtn');
            var ghPagesInfo = document.getElementById('ghPagesInfo');
            var visitPagesBtn = document.getElementById('visitPagesBtn');
            var refreshPagesBtn = document.getElementById('refreshPagesBtn');
            var backToReposFromPagesBtn = document.getElementById('backToReposFromPagesBtn');
            var userProfileContainer = document.getElementById('userProfileContainer');
            var userProfileContent = document.getElementById('userProfileContent');
            var backFromUserProfileBtn = document.getElementById('backFromUserProfileBtn');
            var followUserBtn = document.getElementById('followUserBtn');
            var unfollowUserBtn = document.getElementById('unfollowUserBtn');
            var releaseCreateContainer = document.getElementById('releaseCreateContainer');
            var releaseTagName = document.getElementById('releaseTagName');
            var releaseName = document.getElementById('releaseName');
            var releaseBody = document.getElementById('releaseBody');
            var createReleaseBtn = document.getElementById('createReleaseBtn');
            var cancelCreateReleaseBtn = document.getElementById('cancelCreateReleaseBtn');
            var releaseCreateStatus = document.getElementById('releaseCreateStatus');
            
            // Event listeners for create repo options
            addGitignore.addEventListener('change', function() {
                gitignoreTemplate.disabled = !this.checked;
            });
            
            addLicense.addEventListener('change', function() {
                licenseTemplate.disabled = !this.checked;
            });
            
            // Tab switching
            function setupTabs(container) {
                var tabs = container.querySelectorAll('.tab');
                tabs.forEach(function(tab) {
                    tab.addEventListener('click', function() {
                        // Remove active class from all tabs and contents in this container
                        container.querySelectorAll('.tab').forEach(function(t) {
                            t.classList.remove('active');
                        });
                        container.querySelectorAll('.tab-content').forEach(function(c) {
                            c.classList.remove('active');
                        });
                        
                        // Add active class to clicked tab and corresponding content
                        this.classList.add('active');
                        document.getElementById(this.getAttribute('data-tab') + '-tab').classList.add('active');
                    });
                });
            }
            
            setupTabs(reposContainer);
            setupTabs(repoEditContainer);
            
            // Event listeners
            loginBtn.addEventListener('click', login);
            logoutBtn.addEventListener('click', logout);
            refreshReposBtn.addEventListener('click', loadRepositories);
            refreshStarredBtn.addEventListener('click', loadStarredRepos);
            refreshFollowingBtn.addEventListener('click', loadFollowing);
            createRepoBtn.addEventListener('click', createRepository);
            searchUserBtn.addEventListener('click', function() { searchGitHub('users'); });
            searchRepoBtn.addEventListener('click', function() { searchGitHub('repos'); });
            starRepoBtn.addEventListener('click', starRepository);
            unstarRepoBtn.addEventListener('click', unstarRepository);
            updateRepoBtn.addEventListener('click', updateRepository);
            deleteRepoBtn.addEventListener('click', deleteRepository);
            backToReposBtn.addEventListener('click', backToRepositories);
            
            newFileBtn.addEventListener('click', function() {
                fileBrowser.style.display = 'none';
                fileEditor.style.display = 'none';
                fileCreate.style.display = 'block';
                fileRename.style.display = 'none';
                newFileName.value = '';
                newFileContent.value = '';
                fileCreateStatus.innerHTML = '';
            });
            
            refreshFilesBtn.addEventListener('click', function() {
                browseFiles(currentPath);
            });
            
            saveFileBtn.addEventListener('click', saveFile);
            renameFileBtn.addEventListener('click', showRenameFile);
            backToFilesBtn.addEventListener('click', function() {
                browseFiles(currentPath);
            });
            cancelEditFileBtn.addEventListener('click', cancelEditFile);
            deleteFileBtn.addEventListener('click', deleteFile);
            downloadBtn.addEventListener('click', downloadCurrentFile);
            openInNewTabBtn.addEventListener('click', openInNewTab);
            createFileBtn.addEventListener('click', createFile);
            cancelCreateFileBtn.addEventListener('click', cancelCreateFile);
            confirmRenameFileBtn.addEventListener('click', renameFile);
            cancelRenameFileBtn.addEventListener('click', cancelRenameFile);
            backToReposFromFilesBtn.addEventListener('click', backToRepositories);
            refreshCollabsBtn.addEventListener('click', loadCollaborators);
            backToReposFromCollabsBtn.addEventListener('click', backToRepositories);
            newReleaseBtn.addEventListener('click', showCreateRelease);
            refreshReleasesBtn.addEventListener('click', loadReleases);
            backToReposFromReleasesBtn.addEventListener('click', backToRepositories);
            refreshIssuesBtn.addEventListener('click', loadIssues);
            backToReposFromIssuesBtn.addEventListener('click', backToRepositories);
            refreshDeploymentsBtn.addEventListener('click', loadDeployments);
            backToReposFromDeploymentsBtn.addEventListener('click', backToRepositories);
            refreshPagesBtn.addEventListener('click', loadPagesInfo);
            visitPagesBtn.addEventListener('click', visitPagesSite);
            backToReposFromPagesBtn.addEventListener('click', backToRepositories);
            backFromUserProfileBtn.addEventListener('click', function() {
                userProfileContainer.style.display = 'none';
                if (currentRepo) {
                    repoEditContainer.style.display = 'block';
                } else {
                    reposContainer.style.display = 'block';
                }
            });
            followUserBtn.addEventListener('click', followUser);
            unfollowUserBtn.addEventListener('click', unfollowUser);
            createReleaseBtn.addEventListener('click', createRelease);
            cancelCreateReleaseBtn.addEventListener('click', cancelCreateRelease);
            
            // Check if already logged in (from sessionStorage)
            if (sessionStorage.getItem('githubToken')) {
                authToken = sessionStorage.getItem('githubToken');
                currentUser = sessionStorage.getItem('githubUser');
                showAuthenticatedUI();
                loadUserDetails();
                loadRepositories();
            }
            
            function login() {
                var username = usernameInput.value.trim();
                var token = tokenInput.value.trim();
                
                if (!username || !token) {
                    authStatus.innerHTML = '<div class="error">Please enter both username and token</div>';
                    return;
                }
                
                authToken = token;
                currentUser = username;
                
                // Verify credentials by fetching user details
                githubRequest('GET', 'https://api.github.com/user', null, function(response) {
                    // Success - save to session storage
                    sessionStorage.setItem('githubToken', authToken);
                    sessionStorage.setItem('githubUser', currentUser);
                    
                    showAuthenticatedUI();
                    loadUserDetails();
                    loadRepositories();
                    
                    authStatus.innerHTML = '<div class="success">Login successful!</div>';
                }, function(error) {
                    authToken = null;
                    currentUser = null;
                    authStatus.innerHTML = '<div class="error">Login failed: ' + (error.message || 'Invalid credentials') + '</div>';
                });
            }
            
            function logout() {
                authToken = null;
                currentUser = null;
                sessionStorage.removeItem('githubToken');
                sessionStorage.removeItem('githubUser');
                
                document.querySelectorAll('.auth-section').forEach(function(el) {
                    el.style.display = 'none';
                });
                document.getElementById('authContainer').style.display = 'block';
                usernameInput.value = '';
                tokenInput.value = '';
                authStatus.innerHTML = '<div class="success">Logged out successfully</div>';
            }
            
            function showAuthenticatedUI() {
                document.getElementById('authContainer').style.display = 'none';
                document.querySelectorAll('.auth-section').forEach(function(el) {
                    el.style.display = 'block';
                });
                userNameSpan.textContent = currentUser;
            }
            
            function loadUserDetails() {
                githubRequest('GET', 'https://api.github.com/user', null, function(user) {
                    userNameSpan.textContent = user.login || currentUser;
                }, function(error) {
                    console.error('Failed to load user details:', error);
                });
            }
            
            function loadRepositories() {
                reposList.innerHTML = '<div class="loading">Loading repositories...</div>';
                
                githubRequest('GET', 'https://api.github.com/user/repos?sort=updated', null, function(repos) {
                    if (repos.length === 0) {
                        reposList.innerHTML = '<div>No repositories found.</div>';
                        return;
                    }
                    
                    var html = '';
                    repos.forEach(function(repo) {
                        html += '<div class="repo-item">' +
                                '<div class="repo-name"><a href="javascript:void(0)" onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\', false)">' + repo.name + '</a></div>' +
                                '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + ' | ' + 
                                (repo.private ? 'Private' : 'Public') + '</div>' +
                                '</div>';
                    });
                    
                    reposList.innerHTML = html;
                }, function(error) {
                    reposList.innerHTML = '<div class="error">Failed to load repositories: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadStarredRepos() {
                starredRepos.innerHTML = '<div class="loading">Loading starred repositories...</div>';
                
                githubRequest('GET', 'https://api.github.com/users/' + currentUser + '/starred', null, function(repos) {
                    if (repos.length === 0) {
                        starredRepos.innerHTML = '<div>No starred repositories found.</div>';
                        return;
                    }
                    
                    var html = '';
                    repos.forEach(function(repo) {
                        html += '<div class="repo-item">' +
                                '<div class="repo-name"><a href="javascript:void(0)" onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\', true)">' + repo.full_name + '</a></div>' +
                                '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + ' | ' + 
                                (repo.private ? 'Private' : 'Public') + '</div>' +
                                '</div>';
                    });
                    
                    starredRepos.innerHTML = html;
                }, function(error) {
                    starredRepos.innerHTML = '<div class="error">Failed to load starred repositories: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadFollowing() {
                followingList.innerHTML = '<div class="loading">Loading following...</div>';
                
                githubRequest('GET', 'https://api.github.com/users/' + currentUser + '/following', null, function(users) {
                    if (users.length === 0) {
                        followingList.innerHTML = '<div>You are not following anyone.</div>';
                        return;
                    }
                    
                    var html = '<h3>Following</h3>';
                    users.forEach(function(user) {
                        html += '<div class="user-item">' +
                                '<img src="' + user.avatar_url + '" class="user-avatar" onclick="viewUserProfile(\'' + user.login + '\')" style="cursor:pointer;">' +
                                '<div style="display:inline-block; vertical-align:middle;">' +
                                '<div class="user-name" onclick="viewUserProfile(\'' + user.login + '\')" style="cursor:pointer;">' + user.login + '</div>' +
                                '</div>' +
                                '</div>';
                    });
                    
                    followingList.innerHTML = html;
                }, function(error) {
                    followingList.innerHTML = '<div class="error">Failed to load following: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function createRepository() {
                var name = newRepoName.value.trim();
                var description = newRepoDesc.value.trim();
                var isPrivate = newRepoVisibility.value === 'private';
                
                if (!name) {
                    createRepoStatus.innerHTML = '<div class="error">Repository name is required</div>';
                    return;
                }
                
                var data = {
                    name: name,
                    description: description,
                    private: isPrivate,
                    auto_init: addReadme.checked
                };
                
                if (addGitignore.checked && gitignoreTemplate.value) {
                    data.gitignore_template = gitignoreTemplate.value;
                }
                
                if (addLicense.checked && licenseTemplate.value) {
                    data.license_template = licenseTemplate.value;
                }
                
                createRepoStatus.innerHTML = '<div class="loading">Creating repository...</div>';
                
                githubRequest('POST', 'https://api.github.com/user/repos', data, function(repo) {
                    createRepoStatus.innerHTML = '<div class="success">Repository created successfully! <a href="' + repo.html_url + '" target="_blank">View on GitHub</a></div>';
                    newRepoName.value = '';
                    newRepoDesc.value = '';
                    addReadme.checked = true;
                    addGitignore.checked = false;
                    gitignoreTemplate.disabled = true;
                    gitignoreTemplate.value = '';
                    addLicense.checked = false;
                    licenseTemplate.disabled = true;
                    licenseTemplate.value = '';
                    loadRepositories();
                }, function(error) {
                    createRepoStatus.innerHTML = '<div class="error">Failed to create repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function searchGitHub(type) {
                var query = searchQuery.value.trim();
                
                if (!query) {
                    searchResults.innerHTML = '<div class="error">Please enter a search query</div>';
                    return;
                }
                
                searchResults.innerHTML = '<div class="loading">Searching...</div>';
                
                var url = type === 'users' ? 
                    'https://api.github.com/search/users?q=' + encodeURIComponent(query) :
                    'https://api.github.com/search/repositories?q=' + encodeURIComponent(query);
                
                githubRequest('GET', url, null, function(result) {
                    if (result.items.length === 0) {
                        searchResults.innerHTML = '<div>No results found.</div>';
                        return;
                    }
                    
                    var html = '';
                    if (type === 'users') {
                        html = '<h3>Users</h3>';
                        result.items.forEach(function(user) {
                            html += '<div class="repo-item">' +
                                    '<img src="' + user.avatar_url + '" width="50" style="border-radius:50%; vertical-align:middle; margin-right:10px;">' +
                                    '<div style="display:inline-block; vertical-align:middle;">' +
                                    '<div class="repo-name"><a href="javascript:void(0)" onclick="viewUserProfile(\'' + user.login + '\')">' + user.login + '</a></div>' +
                                    '</div>' +
                                    '</div>';
                        });
                    } else {
                        html = '<h3>Repositories</h3>';
                        result.items.forEach(function(repo) {
                            html += '<div class="repo-item">' +
                                    '<div class="repo-name"><a href="javascript:void(0)" onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\', true)">' + repo.full_name + '</a></div>' +
                                    '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                    '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + ' | ' + 
                                    (repo.private ? 'Private' : 'Public') + '</div>' +
                                    '</div>';
                        });
                    }
                    
                    searchResults.innerHTML = html;
                }, function(error) {
                    searchResults.innerHTML = '<div class="error">Search failed: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function editRepository(owner, repoName, isExternal) {
                currentRepo = { owner: owner, name: repoName };
                currentPath = '';
                isViewingExternalRepo = isExternal;
                
                githubRequest('GET', 'https://api.github.com/repos/' + owner + '/' + repoName, null, function(repo) {
                    editRepoName.textContent = repoName;
                    repoOwner.textContent = 'by ' + owner;
                    editRepoDesc.value = repo.description || '';
                    
                    // Load README if available
                    loadReadme(owner, repoName);
                    
                    // Check if repo is starred
                    if (authToken) {
                        githubRequest('GET', 'https://api.github.com/user/starred/' + owner + '/' + repoName, null, function() {
                            isRepoStarred = true;
                            starRepoBtn.style.display = 'none';
                            unstarRepoBtn.style.display = 'inline-block';
                        }, function(error) {
                            if (error.status === 404) {
                                isRepoStarred = false;
                                starRepoBtn.style.display = 'inline-block';
                                unstarRepoBtn.style.display = 'none';
                            }
                        });
                    }
                    
                    // Set up breadcrumb
                    updateBreadcrumb();
                    
                    // Load root directory
                    browseFiles('');
                    
                    // Hide management tabs if viewing external repo
                    if (isExternal) {
                        document.querySelectorAll('[data-tab="repo-info"], [data-tab="repo-collabs"], [data-tab="repo-pages"]').forEach(function(tab) {
                            tab.style.display = 'none';
                        });
                    } else {
                        document.querySelectorAll('[data-tab="repo-info"], [data-tab="repo-collabs"], [data-tab="repo-pages"]').forEach(function(tab) {
                            tab.style.display = 'block';
                        });
                    }
                    
                    // Load collaborators if not external
                    if (!isExternal) {
                        loadCollaborators();
                    }
                    
                    // Load releases, issues, deployments, pages info
                    loadReleases();
                    loadIssues();
                    loadDeployments();
                    loadPagesInfo();
                    
                    reposContainer.style.display = 'none';
                    repoEditContainer.style.display = 'block';
                    repoEditStatus.innerHTML = '';
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to load repository details</div>';
                });
            }
            
            function loadReadme(owner, repoName) {
                repoReadme.innerHTML = '<div class="loading">Loading README...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + owner + '/' + repoName + '/readme', null, function(readme) {
                    // Decode base64 content
                    var content = atob(readme.content.replace(/\s/g, ''));
                    
                    // Render markdown
                    var html = content
                        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                        .replace(/\!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">')
                        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/_([^_]+)_/g, '<em>$1</em>')
                        .replace(/`(.*?)`/g, '<code>$1</code>')
                        .replace(/\n\n/g, '<br><br>');
                    
                    repoReadme.innerHTML = html;
                }, function(error) {
                    repoReadme.innerHTML = '<div>No README found for this repository.</div>';
                });
            }
            
            function starRepository() {
                if (!currentRepo) return;
                
                githubRequest('PUT', 'https://api.github.com/user/starred/' + currentRepo.owner + '/' + currentRepo.name, null, function() {
                    isRepoStarred = true;
                    starRepoBtn.style.display = 'none';
                    unstarRepoBtn.style.display = 'inline-block';
                    loadStarredRepos();
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to star repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function unstarRepository() {
                if (!currentRepo) return;
                
                githubRequest('DELETE', 'https://api.github.com/user/starred/' + currentRepo.owner + '/' + currentRepo.name, null, function() {
                    isRepoStarred = false;
                    starRepoBtn.style.display = 'inline-block';
                    unstarRepoBtn.style.display = 'none';
                    loadStarredRepos();
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to unstar repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function updateRepository() {
                if (!currentRepo) return;
                
                var newDescription = editRepoDesc.value.trim();
                
                var data = {
                    name: currentRepo.name,
                    description: newDescription,
                    private: false
                };
                
                repoEditStatus.innerHTML = '<div class="loading">Updating repository...</div>';
                
                githubRequest('PATCH', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name, data, function(repo) {
                    repoEditStatus.innerHTML = '<div class="success">Repository updated successfully!</div>';
                    loadRepositories();
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to update repository: ' + (error.message || 'Unknown error') + 
                                              (error.errors ? ' - ' + JSON.stringify(error.errors) : '') + '</div>';
                });
            }
            
            function deleteRepository() {
                if (!currentRepo) return;
                
                if (!confirm('Are you sure you want to delete this repository? This action cannot be undone.')) {
                    return;
                }
                
                repoEditStatus.innerHTML = '<div class="loading">Deleting repository...</div>';
                
                githubRequest('DELETE', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name, null, function() {
                    repoEditStatus.innerHTML = '<div class="success">Repository deleted successfully!</div>';
                    setTimeout(function() {
                        backToRepositories();
                    }, 1500);
                }, function(error) {
                    repoEditStatus.innerHTML = '<div class="error">Failed to delete repository: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function browseFiles(path) {
                fileBrowser.innerHTML = '<div class="loading">Loading files...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, null, function(contents) {
                    if (!Array.isArray(contents)) {
                        contents = [contents];
                    }
                    
                    var html = '';
                    
                    // Add parent directory link if not at root
                    if (path) {
                        var parentPath = path.split('/').slice(0, -1).join('/');
                        html += '<div class="file-item">' +
                                '<div class="file-name"><a href="javascript:void(0)" onclick="browseFiles(\'' + parentPath + '\')">../</a></div>' +
                                '<div class="file-content">Parent directory</div>' +
                                '</div>';
                    }
                    
                    contents.forEach(function(item) {
                        if (item.type === 'dir') {
                            html += '<div class="file-item">' +
                                    '<div class="file-name"><a href="javascript:void(0)" onclick="browseFiles(\'' + (path ? path + '/' : '') + item.name + '\')">' + item.name + '/</a></div>' +
                                    '<div class="file-content">Directory</div>' +
                                    '</div>';
                        } else {
                            html += '<div class="file-item">' +
                                    '<div class="file-name"><a href="javascript:void(0)" onclick="viewFile(\'' + (path ? path + '/' : '') + item.name + '\', \'' + item.sha + '\')">' + item.name + '</a></div>' +
                                    '<div class="file-content">' + (item.size ? (item.size + ' bytes') : 'File') + '</div>' +
                                    '</div>';
                        }
                    });
                    
                    fileBrowser.innerHTML = html;
                    fileBrowser.style.display = 'block';
                    fileEditor.style.display = 'none';
                    fileCreate.style.display = 'none';
                    fileRename.style.display = 'none';
                    
                    // Update current path and breadcrumb
                    currentPath = path;
                    updateBreadcrumb();
                }, function(error) {
                    fileBrowser.innerHTML = '<div class="error">Failed to load files: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function viewFile(path, sha) {
                currentFile = path;
                currentFileSha = sha;
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, null, function(file) {
                    // Decode base64 content
                    var content = atob(file.content.replace(/\s/g, ''));
                    
                    // Set download URL
                    currentDownloadUrl = file.download_url;
                    downloadImageBtn.href = file.download_url;
                    downloadImageBtn.download = path.split('/').pop();
                    downloadFileBtn.href = file.download_url;
                    downloadFileBtn.download = path.split('/').pop();
                    
                    // Check file type
                    var isImage = /\.(jpg|jpeg|png|gif|bmp|ico|svg)$/i.test(path);
                    var isMarkdown = /\.md$/i.test(path);
                    
                    if (isImage) {
                        // Display image
                        fileContentEditor.style.display = 'none';
                        markdownPreview.style.display = 'none';
                        imagePreview.style.display = 'block';
                        fileDownload.style.display = 'none';
                        imagePreviewImg.src = file.download_url;
                    } else if (isMarkdown) {
                        // Display markdown with preview
                        fileContentEditor.style.display = 'block';
                        markdownPreview.style.display = 'block';
                        imagePreview.style.display = 'none';
                        fileDownload.style.display = 'none';
                        fileContentEditor.value = content;
                        renderMarkdownPreview(content);
                    } else {
                        // Display regular file
                        fileContentEditor.style.display = 'block';
                        markdownPreview.style.display = 'none';
                        imagePreview.style.display = 'none';
                        fileDownload.style.display = 'block';
                        fileContentEditor.value = content;
                    }
                    
                    // Show/hide edit buttons based on whether it's an external repo
                    if (isViewingExternalRepo) {
                        saveFileBtn.style.display = 'none';
                        renameFileBtn.style.display = 'none';
                        deleteFileBtn.style.display = 'none';
                        downloadBtn.style.display = 'inline-block';
                        openInNewTabBtn.style.display = 'inline-block';
                    } else {
                        saveFileBtn.style.display = 'inline-block';
                        renameFileBtn.style.display = 'inline-block';
                        deleteFileBtn.style.display = 'inline-block';
                        downloadBtn.style.display = 'inline-block';
                        openInNewTabBtn.style.display = 'inline-block';
                    }
                    
                    fileBrowser.style.display = 'none';
                    fileEditor.style.display = 'block';
                    fileCreate.style.display = 'none';
                    fileRename.style.display = 'none';
                    fileEditStatus.innerHTML = '';
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to load file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function openInNewTab() {
                if (!currentDownloadUrl) return;
                window.open(currentDownloadUrl, '_blank');
            }
            
            function renderMarkdownPreview(content) {
                // Simple markdown rendering (basic replacements)
                var html = content
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/\!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">')
                    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/_([^_]+)_/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    .replace(/\n\n/g, '<br><br>');
                
                markdownPreview.innerHTML = html;
            }
            
            function downloadCurrentFile() {
                if (!currentDownloadUrl) return;
                
                // Create a temporary anchor element to trigger download
                var a = document.createElement('a');
                a.href = currentDownloadUrl;
                a.download = currentFile.split('/').pop();
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
            
            function saveFile() {
                if (!currentFile || !currentFileSha) return;
                
                var newContent = fileContentEditor.value;
                var encodedContent = btoa(newContent);
                
                var data = {
                    message: 'Update ' + currentFile,
                    content: encodedContent,
                    sha: currentFileSha
                };
                
                fileEditStatus.innerHTML = '<div class="loading">Saving file...</div>';
                
                githubRequest('PUT', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, data, function() {
                    fileEditStatus.innerHTML = '<div class="success">File saved successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to save file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function showRenameFile() {
                if (!currentFile) return;
                
                fileEditor.style.display = 'none';
                fileRename.style.display = 'block';
                renameFilePath.value = currentFile;
                fileRenameStatus.innerHTML = '';
            }
            
            function renameFile() {
                if (!currentFile || !currentFileSha) return;
                
                var newPath = renameFilePath.value.trim();
                
                if (!newPath) {
                    fileRenameStatus.innerHTML = '<div class="error">New file path is required</div>';
                    return;
                }
                
                if (newPath === currentFile) {
                    cancelRenameFile();
                    return;
                }
                
                // Get current file content
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, null, function(file) {
                    var content = file.content;
                    
                    // Create new file
                    var createData = {
                        message: 'Rename ' + currentFile + ' to ' + newPath,
                        content: content
                    };
                    
                    fileRenameStatus.innerHTML = '<div class="loading">Creating new file...</div>';
                    
                    githubRequest('PUT', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + newPath, createData, function() {
                        // Delete old file
                        var deleteData = {
                            message: 'Remove ' + currentFile + ' after rename',
                            sha: currentFileSha
                        };
                        
                        githubRequest('DELETE', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, deleteData, function() {
                            fileRenameStatus.innerHTML = '<div class="success">File renamed successfully!</div>';
                            setTimeout(function() {
                                browseFiles(currentPath);
                            }, 1000);
                        }, function(error) {
                            fileRenameStatus.innerHTML = '<div class="error">File renamed but failed to delete old file: ' + (error.message || 'Unknown error') + '</div>';
                        });
                    }, function(error) {
                        fileRenameStatus.innerHTML = '<div class="error">Failed to create new file: ' + (error.message || 'Unknown error') + '</div>';
                    });
                }, function(error) {
                    fileRenameStatus.innerHTML = '<div class="error">Failed to get file content: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function cancelRenameFile() {
                fileRename.style.display = 'none';
                fileEditor.style.display = 'block';
            }
            
            function cancelEditFile() {
                browseFiles(currentPath);
            }
            
            function deleteFile() {
                if (!currentFile || !currentFileSha) return;
                
                if (!confirm('Are you sure you want to delete this file?')) {
                    return;
                }
                
                var data = {
                    message: 'Delete ' + currentFile,
                    sha: currentFileSha
                };
                
                fileEditStatus.innerHTML = '<div class="loading">Deleting file...</div>';
                
                githubRequest('DELETE', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + currentFile, data, function() {
                    fileEditStatus.innerHTML = '<div class="success">File deleted successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileEditStatus.innerHTML = '<div class="error">Failed to delete file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function createFile() {
                var path = newFileName.value.trim();
                var content = newFileContent.value;
                
                if (!path) {
                    fileCreateStatus.innerHTML = '<div class="error">File path is required</div>';
                    return;
                }
                
                var encodedContent = btoa(content);
                
                var data = {
                    message: 'Create ' + path,
                    content: encodedContent
                };
                
                fileCreateStatus.innerHTML = '<div class="loading">Creating file...</div>';
                
                githubRequest('PUT', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/contents/' + path, data, function() {
                    fileCreateStatus.innerHTML = '<div class="success">File created successfully!</div>';
                    setTimeout(function() {
                        browseFiles(currentPath);
                    }, 1000);
                }, function(error) {
                    fileCreateStatus.innerHTML = '<div class="error">Failed to create file: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function cancelCreateFile() {
                browseFiles(currentPath);
            }
            
            function loadCollaborators() {
                collabsList.innerHTML = '<div class="loading">Loading collaborators...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/collaborators', null, function(collaborators) {
                    if (collaborators.length === 0) {
                        collabsList.innerHTML = '<div>No collaborators found for this repository.</div>';
                        return;
                    }
                    
                    var html = '<h3>Collaborators</h3>';
                    collaborators.forEach(function(collab) {
                        html += '<div class="collab-item">' +
                                '<img src="' + collab.avatar_url + '" class="collab-avatar" onclick="viewUserProfile(\'' + collab.login + '\')" style="cursor:pointer;">' +
                                '<div style="display:inline-block; vertical-align:middle;">' +
                                '<div class="collab-name" onclick="viewUserProfile(\'' + collab.login + '\')" style="cursor:pointer;">' + collab.login + '</div>' +
                                '<div class="collab-role">Permissions: ' + (collab.permissions.admin ? 'Admin' : 
                                    (collab.permissions.push ? 'Write' : 'Read')) + '</div>' +
                                '</div>' +
                                '</div>';
                    });
                    
                    collabsList.innerHTML = html;
                }, function(error) {
                    collabsList.innerHTML = '<div class="error">Failed to load collaborators: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function showCreateRelease() {
                repoEditContainer.style.display = 'none';
                releaseCreateContainer.style.display = 'block';
                releaseTagName.value = '';
                releaseName.value = '';
                releaseBody.value = '';
                releaseCreateStatus.innerHTML = '';
            }
            
            function cancelCreateRelease() {
                releaseCreateContainer.style.display = 'none';
                repoEditContainer.style.display = 'block';
            }
            
            function createRelease() {
                if (!currentRepo) return;
                
                var tagName = releaseTagName.value.trim();
                var name = releaseName.value.trim();
                var body = releaseBody.value.trim();
                
                if (!tagName) {
                    releaseCreateStatus.innerHTML = '<div class="error">Tag name is required</div>';
                    return;
                }
                
                var data = {
                    tag_name: tagName,
                    name: name,
                    body: body,
                    draft: false,
                    prerelease: false
                };
                
                releaseCreateStatus.innerHTML = '<div class="loading">Creating release...</div>';
                
                githubRequest('POST', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/releases', data, function(release) {
                    releaseCreateStatus.innerHTML = '<div class="success">Release created successfully! <a href="' + release.html_url + '" target="_blank">View on GitHub</a></div>';
                    setTimeout(function() {
                        releaseCreateContainer.style.display = 'none';
                        repoEditContainer.style.display = 'block';
                        loadReleases();
                    }, 1500);
                }, function(error) {
                    releaseCreateStatus.innerHTML = '<div class="error">Failed to create release: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadReleases() {
                releasesList.innerHTML = '<div class="loading">Loading releases...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/releases', null, function(releases) {
                    if (releases.length === 0) {
                        releasesList.innerHTML = '<div>No releases found for this repository.</div>';
                        return;
                    }
                    
                    var html = '';
                    releases.forEach(function(release) {
                        html += '<div class="release-item">' +
                                '<div class="release-name">' + release.name + ' <small>(' + release.tag_name + ')</small></div>';
                        
                        // Add markdown-rendered body if available
                        if (release.body) {
                            html += '<div class="markdown-preview">' + 
                                    release.body
                                        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                                        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                                        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                                        .replace(/\!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">')
                                        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
                                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                                        .replace(/_([^_]+)_/g, '<em>$1</em>')
                                        .replace(/`(.*?)`/g, '<code>$1</code>')
                                        .replace(/\n\n/g, '<br><br>') +
                                    '</div>';
                        }
                        
                        html += '<div>Published: ' + new Date(release.published_at).toLocaleString() + '</div>';
                        
                        if (release.assets && release.assets.length > 0) {
                            html += '<div><strong>Assets:</strong></div>';
                            release.assets.forEach(function(asset) {
                                html += '<div class="release-asset">' +
                                        '<a href="' + asset.browser_download_url + '" target="_blank">' + asset.name + '</a> (' + 
                                        formatFileSize(asset.size) + ')' +
                                        '</div>';
                            });
                        }
                        
                        html += '</div>';
                    });
                    
                    releasesList.innerHTML = html;
                }, function(error) {
                    releasesList.innerHTML = '<div class="error">Failed to load releases: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadIssues() {
                issuesList.innerHTML = '<div class="loading">Loading issues...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/issues', null, function(issues) {
                    if (issues.length === 0) {
                        issuesList.innerHTML = '<div>No issues found for this repository.</div>';
                        return;
                    }
                    
                    var html = '<h3>Issues</h3>';
                    issues.forEach(function(issue) {
                        var labelHtml = '';
                        if (issue.labels && issue.labels.length > 0) {
                            issue.labels.forEach(function(label) {
                                labelHtml += '<span class="issue-label" style="background-color:#' + label.color + '">' + label.name + '</span>';
                            });
                        }
                        
                        html += '<div class="issue-item">' +
                                '<div class="issue-name"><a href="' + issue.html_url + '" target="_blank">' + issue.title + '</a> #' + issue.number + '</div>' +
                                '<div class="issue-desc">' + labelHtml + 'Opened by ' + issue.user.login + ' on ' + new Date(issue.created_at).toLocaleString() + '</div>' +
                                '</div>';
                    });
                    
                    issuesList.innerHTML = html;
                }, function(error) {
                    issuesList.innerHTML = '<div class="error">Failed to load issues: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadDeployments() {
                deploymentsList.innerHTML = '<div class="loading">Loading deployments...</div>';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/deployments', null, function(deployments) {
                    if (deployments.length === 0) {
                        deploymentsList.innerHTML = '<div>No deployments found for this repository.</div>';
                        return;
                    }
                    
                    var html = '<h3>Deployments</h3>';
                    
                    // We'll need to get status for each deployment
                    var deploymentPromises = deployments.map(function(deployment) {
                        return new Promise(function(resolve) {
                            githubRequest('GET', deployment.statuses_url, null, function(statuses) {
                                var status = statuses[0] || {};
                                resolve({
                                    deployment: deployment,
                                    status: status
                                });
                            }, function() {
                                resolve({
                                    deployment: deployment,
                                    status: {}
                                });
                            });
                        });
                    });
                    
                    Promise.all(deploymentPromises).then(function(results) {
                        results.forEach(function(result) {
                            var deployment = result.deployment;
                            var status = result.status;
                            
                            var statusClass = 'status-pending';
                            if (status.state === 'success') statusClass = 'status-success';
                            else if (status.state === 'failure') statusClass = 'status-failure';
                            
                            html += '<div class="deployment-item">' +
                                    '<div class="issue-name">' + deployment.environment + ' <small>(' + deployment.ref + ')</small></div>' +
                                    '<div class="issue-desc">' +
                                    '<span class="deployment-status ' + statusClass + '">' + (status.state || 'pending') + '</span>' +
                                    'Deployed by ' + deployment.creator.login + ' on ' + new Date(deployment.created_at).toLocaleString() +
                                    '</div>' +
                                    '</div>';
                        });
                        
                        deploymentsList.innerHTML = html;
                    });
                }, function(error) {
                    deploymentsList.innerHTML = '<div class="error">Failed to load deployments: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function loadPagesInfo() {
                ghPagesInfo.innerHTML = '<div class="loading">Loading GitHub Pages info...</div>';
                visitPagesBtn.style.display = 'none';
                
                githubRequest('GET', 'https://api.github.com/repos/' + currentRepo.owner + '/' + currentRepo.name + '/pages', null, function(pagesInfo) {
                    var html = '<h3>GitHub Pages</h3>';
                    
                    if (pagesInfo && pagesInfo.status === 'built') {
                        html += '<div class="success">GitHub Pages is enabled!</div>' +
                                '<p>Your site is published at: <a href="' + pagesInfo.html_url + '" target="_blank">' + pagesInfo.html_url + '</a></p>' +
                                '<p>Source: ' + pagesInfo.source.branch + ' branch' + 
                                (pagesInfo.source.path ? ', ' + pagesInfo.source.path + ' directory' : '') + '</p>' +
                                '<p>Last updated: ' + new Date(pagesInfo.updated_at).toLocaleString() + '</p>';
                        
                        visitPagesBtn.style.display = 'inline-block';
                        visitPagesBtn.onclick = function() {
                            window.open(pagesInfo.html_url, '_blank');
                        };
                    } else {
                        html += '<div>GitHub Pages is not enabled for this repository.</div>' +
                                '<p>To enable GitHub Pages, create a branch named "gh-pages" or use the "docs" folder on your main branch.</p>';
                    }
                    
                    ghPagesInfo.innerHTML = html;
                }, function(error) {
                    if (error.status === 404) {
                        ghPagesInfo.innerHTML = '<div>GitHub Pages is not enabled for this repository.</div>' +
                                '<p>To enable GitHub Pages, create a branch named "gh-pages" or use the "docs" folder on your main branch.</p>';
                    } else {
                        ghPagesInfo.innerHTML = '<div class="error">Failed to load GitHub Pages info: ' + (error.message || 'Unknown error') + '</div>';
                    }
                });
            }
            
            function visitPagesSite() {
                // Handled in the loadPagesInfo function when setting up the button
            }
            
            function viewUserProfile(username) {
                currentProfileUser = username;
                userProfileContent.innerHTML = '<div class="loading">Loading user profile...</div>';
                followUserBtn.style.display = 'none';
                unfollowUserBtn.style.display = 'none';
                
                // Get user info
                githubRequest('GET', 'https://api.github.com/users/' + username, null, function(user) {
                    // Check if we're following this user (if not viewing our own profile)
                    if (authToken && username !== currentUser) {
                        githubRequest('GET', 'https://api.github.com/user/following/' + username, null, function() {
                            isFollowingUser = true;
                            followUserBtn.style.display = 'none';
                            unfollowUserBtn.style.display = 'inline-block';
                            loadProfileContent(user);
                        }, function(error) {
                            if (error.status === 404) {
                                isFollowingUser = false;
                                followUserBtn.style.display = 'inline-block';
                                unfollowUserBtn.style.display = 'none';
                                loadProfileContent(user);
                            } else {
                                loadProfileContent(user);
                            }
                        });
                    } else {
                        loadProfileContent(user);
                    }
                }, function(error) {
                    userProfileContent.innerHTML = '<div class="error">Failed to load user profile</div>';
                });
            }
            
            function loadProfileContent(user) {
                // Get user's organizations
                githubRequest('GET', 'https://api.github.com/users/' + user.login + '/orgs', null, function(orgs) {
                    // Get user's starred repos
                    githubRequest('GET', 'https://api.github.com/users/' + user.login + '/starred', null, function(starredRepos) {
                        var html = '<div class="user-profile">' +
                                   '<img src="' + user.avatar_url + '" class="user-avatar">' +
                                   '<div class="user-info">' +
                                   '<div class="user-name">' + (user.name || '') + '</div>' +
                                   '<div class="user-login">@' + user.login + '</div>' +
                                   '</div>' +
                                   '</div>';
                        
                        if (user.bio) {
                            html += '<div class="user-bio">' + user.bio + '</div>';
                        }
                        
                        html += '<div class="user-stats">' +
                                '<div class="user-stat">Followers: ' + user.followers + '</div>' +
                                '<div class="user-stat">Following: ' + user.following + '</div>' +
                                '</div>';
                        
                        if (orgs.length > 0) {
                            html += '<div><strong>Organizations:</strong></div>';
                            orgs.forEach(function(org) {
                                html += '<img src="' + org.avatar_url + '" class="org-avatar" title="' + org.login + '">';
                            });
                            html += '<br><br>';
                        }
                        
                        // Show starred repos if any
                        if (starredRepos.length > 0) {
                            html += '<div><strong>Starred Repositories:</strong></div>';
                            starredRepos.slice(0, 5).forEach(function(repo) {
                                html += '<div class="repo-item">' +
                                        '<div class="repo-name"><a href="javascript:void(0)" onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\', true)">' + repo.full_name + '</a></div>' +
                                        '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                        '</div>';
                            });
                            if (starredRepos.length > 5) {
                                html += '<div>...and ' + (starredRepos.length - 5) + ' more</div>';
                            }
                        }
                        
                        // Add button to view user's repos
                        html += '<div class="file-actions">' +
                                '<button onclick="viewUserRepos(\'' + user.login + '\')">View Repositories</button>' +
                                '</div>';
                        
                        userProfileContent.innerHTML = html;
                        
                        // Show the profile container
                        repoEditContainer.style.display = 'none';
                        reposContainer.style.display = 'none';
                        userProfileContainer.style.display = 'block';
                    }, function(error) {
                        userProfileContent.innerHTML = '<div class="error">Failed to load starred repositories</div>';
                    });
                }, function(error) {
                    userProfileContent.innerHTML = '<div class="error">Failed to load organizations</div>';
                });
            }
            
            function followUser() {
                if (!currentProfileUser) return;
                
                githubRequest('PUT', 'https://api.github.com/user/following/' + currentProfileUser, null, function() {
                    isFollowingUser = true;
                    followUserBtn.style.display = 'none';
                    unfollowUserBtn.style.display = 'inline-block';
                }, function(error) {
                    userProfileContent.innerHTML = '<div class="error">Failed to follow user: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function unfollowUser() {
                if (!currentProfileUser) return;
                
                githubRequest('DELETE', 'https://api.github.com/user/following/' + currentProfileUser, null, function() {
                    isFollowingUser = false;
                    followUserBtn.style.display = 'inline-block';
                    unfollowUserBtn.style.display = 'none';
                }, function(error) {
                    userProfileContent.innerHTML = '<div class="error">Failed to unfollow user: ' + (error.message || 'Unknown error') + '</div>';
                });
            }
            
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            }
            
            function updateBreadcrumb() {
                var parts = currentPath.split('/');
                var breadcrumb = '<a href="javascript:void(0)" onclick="browseFiles(\'\')">' + currentRepo.name + '</a>';
                
                var currentPathPart = '';
                parts.forEach(function(part, index) {
                    if (part) {
                        currentPathPart += (currentPathPart ? '/' : '') + part;
                        breadcrumb += ' / <a href="javascript:void(0)" onclick="browseFiles(\'' + currentPathPart + '\')">' + part + '</a>';
                    }
                });
                
                repoBreadcrumb.innerHTML = breadcrumb;
            }
            
            function backToRepositories() {
                repoEditContainer.style.display = 'none';
                releaseCreateContainer.style.display = 'none';
                reposContainer.style.display = 'block';
                currentRepo = null;
                currentPath = '';
                currentFile = null;
                currentFileSha = null;
                isViewingExternalRepo = false;
            }
            
            // Make GitHub API requests
            function githubRequest(method, url, data, successCallback, errorCallback) {
                var xhr = new XMLHttpRequest();
                xhr.open(method, url);
                xhr.setRequestHeader('Accept', 'application/vnd.github.v3+json');
                
                if (authToken) {
                    xhr.setRequestHeader('Authorization', 'token ' + authToken);
                }
                
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var response = xhr.responseText ? JSON.parse(xhr.responseText) : null;
                        if (successCallback) successCallback(response);
                    } else {
                        var error = xhr.responseText ? JSON.parse(xhr.responseText) : { message: 'HTTP error ' + xhr.status };
                        if (errorCallback) errorCallback(error);
                    }
                };
                
                xhr.onerror = function() {
                    if (errorCallback) errorCallback({ message: 'Network error' });
                };
                
                if (data) {
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.send(JSON.stringify(data));
                } else {
                    xhr.send();
                }
            }
            
            // Make functions available globally for button onclick handlers
            window.editRepository = editRepository;
            window.browseFiles = browseFiles;
            window.viewFile = viewFile;
            window.viewUserProfile = viewUserProfile;
            window.viewUserRepos = function(username) {
                searchResults.innerHTML = '<div class="loading">Loading repositories...</div>';
                
                githubRequest('GET', 'https://api.github.com/users/' + encodeURIComponent(username) + '/repos', null, function(repos) {
                    if (repos.length === 0) {
                        searchResults.innerHTML = '<div>No repositories found for this user.</div>';
                        return;
                    }
                    
                    var html = '<h3>' + username + '\'s Repositories</h3>';
                    repos.forEach(function(repo) {
                        html += '<div class="repo-item">' +
                                '<div class="repo-name"><a href="javascript:void(0)" onclick="editRepository(\'' + repo.owner.login + '\', \'' + repo.name + '\', true)">' + repo.name + '</a></div>' +
                                '<div class="repo-desc">' + (repo.description || 'No description') + '</div>' +
                                '<div>Stars: ' + repo.stargazers_count + ' | Forks: ' + repo.forks_count + '</div>' +
                                '</div>';
                    });
                    
                    searchResults.innerHTML = html;
                    
                    // Hide profile and show search results
                    userProfileContainer.style.display = 'none';
                    reposContainer.style.display = 'block';
                }, function(error) {
                    searchResults.innerHTML = '<div class="error">Failed to load repositories: ' + (error.message || 'Unknown error') + '</div>';
                });
            };
        });
    </script>
</body>
</html>
